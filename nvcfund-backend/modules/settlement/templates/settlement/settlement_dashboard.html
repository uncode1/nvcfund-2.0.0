{% extends "base.html" %}

{% block title %}Settlement Operations - NVC Banking Platform{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Settlement Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h1 class="h2 text-white mb-2">
                                <i class="fas fa-handshake me-2"></i>Settlement Operations
                            </h1>
                            <p class="text-light mb-0">Real-time settlement processing and clearing operations</p>
                        </div>
                        <div class="col-auto">
                            <div class="btn-group">
                                <button class="btn btn-light btn-sm">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh
                                </button>
                                <button class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-download me-1"></i>Export
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settlement Metrics -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Settled Today</h4>
                    <h2 class="text-white">${{ "847.2M"|default("0") }}</h2>
                    <small class="text-light">{{ "15,647"|default("0") }} Transactions</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Pending</h4>
                    <h2 class="text-white">${{ "23.5M"|default("0") }}</h2>
                    <small class="text-light">{{ "456"|default("0") }} Transactions</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-danger">
                <div class="card-body text-center">
                    <i class="fas fa-exclamation-triangle fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Failed</h4>
                    <h2 class="text-white">{{ "7"|default("0") }}</h2>
                    <small class="text-light">Requires Attention</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info">
                <div class="card-body text-center">
                    <i class="fas fa-tachometer-alt fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Avg Time</h4>
                    <h2 class="text-white">{{ "2.3"|default("0") }}s</h2>
                    <small class="text-light">Settlement Speed</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Settlement Networks & Real-Time Processing -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-network-wired me-2"></i>Settlement Networks</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6><i class="fas fa-university me-2"></i>Fedwire</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Status:</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Today's Volume:</span>
                                        <span>${{ "425.8M"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Transactions:</span>
                                        <span>{{ "8,456"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Avg Time:</span>
                                        <span>{{ "1.8s"|default("0s") }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6><i class="fas fa-credit-card me-2"></i>ACH Network</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Status:</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Today's Volume:</span>
                                        <span>${{ "156.4M"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Transactions:</span>
                                        <span>{{ "45,892"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Avg Time:</span>
                                        <span>{{ "3.2s"|default("0s") }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6><i class="fas fa-globe me-2"></i>SWIFT Network</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Status:</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Today's Volume:</span>
                                        <span>${{ "89.7M"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Transactions:</span>
                                        <span>{{ "234"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Avg Time:</span>
                                        <span>{{ "45.6s"|default("0s") }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-white">
                                    <h6><i class="fab fa-bitcoin me-2"></i>Blockchain</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Status:</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Today's Volume:</span>
                                        <span>${{ "175.3M"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Transactions:</span>
                                        <span>{{ "1,065"|default("0") }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Avg Time:</span>
                                        <span>{{ "12.4s"|default("0s") }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settlement Queue -->
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list-ol me-2"></i>Settlement Queue</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Wire Transfer</h6>
                                <p class="mb-1 text-muted small">$2,500,000</p>
                                <small class="text-muted">Queue: 00:45</small>
                            </div>
                            <span class="badge bg-warning">Processing</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">ACH Batch</h6>
                                <p class="mb-1 text-muted small">$450,000 (892 items)</p>
                                <small class="text-muted">Queue: 01:12</small>
                            </div>
                            <span class="badge bg-info">Pending</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">International Wire</h6>
                                <p class="mb-1 text-muted small">€1,200,000</p>
                                <small class="text-muted">Queue: 02:30</small>
                            </div>
                            <span class="badge bg-primary">Validating</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Blockchain Tx</h6>
                                <p class="mb-1 text-muted small">50 ETH</p>
                                <small class="text-muted">Queue: 00:23</small>
                            </div>
                            <span class="badge bg-success">Confirming</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Health -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-heartbeat me-2"></i>System Health</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Processing Capacity</label>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 68%">68%</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Network Latency</label>
                        <div class="progress">
                            <div class="progress-bar bg-info" style="width: 25%">Low (45ms)</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Error Rate</label>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 5%">0.02%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Settlements -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-history me-2"></i>Recent Settlements</h5>
                    <span class="badge bg-primary">Live Updates</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Transaction ID</th>
                                    <th>Network</th>
                                    <th>Amount</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Processing Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ "14:35:42"|default("--:--:--") }}</td>
                                    <td><code>TXN-847392847</code></td>
                                    <td><span class="badge bg-success">Fedwire</span></td>
                                    <td>$2,500,000</td>
                                    <td>Chase Bank</td>
                                    <td>Wells Fargo</td>
                                    <td>1.8s</td>
                                    <td><span class="badge bg-success">Settled</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:35:38"|default("--:--:--") }}</td>
                                    <td><code>TXN-847392846</code></td>
                                    <td><span class="badge bg-primary">ACH</span></td>
                                    <td>$15,750</td>
                                    <td>Bank of America</td>
                                    <td>Citibank</td>
                                    <td>3.2s</td>
                                    <td><span class="badge bg-success">Settled</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:35:35"|default("--:--:--") }}</td>
                                    <td><code>TXN-847392845</code></td>
                                    <td><span class="badge bg-info">SWIFT</span></td>
                                    <td>€850,000</td>
                                    <td>Deutsche Bank</td>
                                    <td>BNP Paribas</td>
                                    <td>45.6s</td>
                                    <td><span class="badge bg-success">Settled</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:35:28"|default("--:--:--") }}</td>
                                    <td><code>TXN-847392844</code></td>
                                    <td><span class="badge bg-warning">Blockchain</span></td>
                                    <td>25 ETH</td>
                                    <td>Wallet A</td>
                                    <td>Wallet B</td>
                                    <td>12.4s</td>
                                    <td><span class="badge bg-success">Settled</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:35:20"|default("--:--:--") }}</td>
                                    <td><code>TXN-847392843</code></td>
                                    <td><span class="badge bg-primary">ACH</span></td>
                                    <td>$75,480</td>
                                    <td>JPMorgan Chase</td>
                                    <td>US Bank</td>
                                    <td>2.9s</td>
                                    <td><span class="badge bg-success">Settled</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settlement Analytics -->
    <div class="row mt-4">
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar me-2"></i>Settlement Volume by Network</h5>
                </div>
                <div class="card-body">
                    <canvas id="volumeChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-clock me-2"></i>Processing Times</h5>
                </div>
                <div class="card-body">
                    <canvas id="timingChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Volume Chart
    const volumeCtx = document.getElementById('volumeChart').getContext('2d');
    new Chart(volumeCtx, {
        type: 'bar',
        data: {
            labels: ['Fedwire', 'ACH', 'SWIFT', 'Blockchain'],
            datasets: [{
                label: 'Settlement Volume ($M)',
                data: [425.8, 156.4, 89.7, 175.3],
                backgroundColor: [
                    '#198754',
                    '#0d6efd',
                    '#17a2b8',
                    '#ffc107'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value + 'M';
                        }
                    }
                }
            }
        }
    });

    // Timing Chart
    const timingCtx = document.getElementById('timingChart').getContext('2d');
    new Chart(timingCtx, {
        type: 'line',
        data: {
            labels: ['12:00', '13:00', '14:00', '15:00', '16:00'],
            datasets: [{
                label: 'Avg Processing Time (s)',
                data: [2.1, 2.5, 2.3, 2.4, 2.2],
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + 's';
                        }
                    }
                }
            }
        }
    });

    // Auto-refresh every 30 seconds
    setInterval(function() {
        // In production, this would refresh the data
        console.log('Refreshing settlement data...');
    }, 30000);
});
</script>
{% endblock %}