{% extends "base.html" %}

{% block title %}Security Center - NVC Banking Platform{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Security Center Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-danger">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h1 class="h2 text-white mb-2">
                                <i class="fas fa-shield-alt me-2"></i>Security Center
                            </h1>
                            <p class="text-light mb-0">Comprehensive security monitoring and threat management</p>
                        </div>
                        <div class="col-auto">
                            <div class="btn-group">
                                <button class="btn btn-light btn-sm">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh
                                </button>
                                <button class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-download me-1"></i>Export
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Metrics -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">System Status</h4>
                    <h2 class="text-white">Secure</h2>
                    <small class="text-light">All Systems Green</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning">
                <div class="card-body text-center">
                    <i class="fas fa-exclamation-triangle fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Active Threats</h4>
                    <h2 class="text-white">{{ "3"|default("0") }}</h2>
                    <small class="text-light">Being Monitored</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info">
                <div class="card-body text-center">
                    <i class="fas fa-user-shield fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Failed Logins</h4>
                    <h2 class="text-white">{{ "47"|default("0") }}</h2>
                    <small class="text-light">Last 24 Hours</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-primary">
                <div class="card-body text-center">
                    <i class="fas fa-lock fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Security Score</h4>
                    <h2 class="text-white">{{ "98.7%"|default("0%") }}</h2>
                    <small class="text-light">Excellent</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Detection & Monitoring -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-radar-alt me-2"></i>Real-time Threat Detection</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Threat Type</th>
                                    <th>Source IP</th>
                                    <th>Severity</th>
                                    <th>Action Taken</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ "14:35"|default("--:--") }}</td>
                                    <td>Brute Force Attack</td>
                                    <td>192.168.1.100</td>
                                    <td><span class="badge bg-danger">High</span></td>
                                    <td>IP Blocked</td>
                                    <td><span class="badge bg-success">Mitigated</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:22"|default("--:--") }}</td>
                                    <td>Suspicious Login</td>
                                    <td>10.0.0.45</td>
                                    <td><span class="badge bg-warning">Medium</span></td>
                                    <td>MFA Required</td>
                                    <td><span class="badge bg-warning">Monitoring</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:15"|default("--:--") }}</td>
                                    <td>SQL Injection</td>
                                    <td>203.0.113.5</td>
                                    <td><span class="badge bg-danger">High</span></td>
                                    <td>Request Blocked</td>
                                    <td><span class="badge bg-success">Blocked</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "14:08"|default("--:--") }}</td>
                                    <td>Unusual Traffic</td>
                                    <td>198.51.100.22</td>
                                    <td><span class="badge bg-info">Low</span></td>
                                    <td>Rate Limited</td>
                                    <td><span class="badge bg-info">Monitoring</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Quick Actions -->
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-tools me-2"></i>Security Tools</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-danger" onclick="emergencyLockdown()">
                            <i class="fas fa-ban me-2"></i>Emergency Lockdown
                        </button>
                        <button class="btn btn-warning" onclick="forcePasswordReset()">
                            <i class="fas fa-key me-2"></i>Force Password Reset
                        </button>
                        <button class="btn btn-info" onclick="generateSecurityReport()">
                            <i class="fas fa-file-alt me-2"></i>Generate Report
                        </button>
                        <button class="btn btn-primary" onclick="runSecurityScan()">
                            <i class="fas fa-search me-2"></i>Run Security Scan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Security Alerts -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-bell me-2"></i>Active Alerts</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>3 failed login attempts</strong> detected for admin account in the last hour.
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>SSL certificate</strong> expires in 30 days. Renewal recommended.
                    </div>
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Security scan completed</strong> successfully. No vulnerabilities found.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Access Control & User Activity -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-users-cog me-2"></i>Access Control</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Active Sessions</label>
                        <div class="progress">
                            <div class="progress-bar bg-primary" style="width: 35%">1,247 Users Online</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">MFA Compliance</label>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 87%">87% Enabled</div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password Strength</label>
                        <div class="progress">
                            <div class="progress-bar bg-warning" style="width: 72%">72% Strong</div>
                        </div>
                    </div>
                    
                    <h6>Recent Access Events</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Action</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>admin@nvcbank.com</td>
                                    <td>Login</td>
                                    <td>{{ "14:35"|default("--:--") }}</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>user@example.com</td>
                                    <td>Password Change</td>
                                    <td>{{ "14:20"|default("--:--") }}</td>
                                    <td><span class="badge bg-info">Success</span></td>
                                </tr>
                                <tr>
                                    <td>unknown@suspicious.com</td>
                                    <td>Login Attempt</td>
                                    <td>{{ "14:15"|default("--:--") }}</td>
                                    <td><span class="badge bg-danger">Failed</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Health -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-heartbeat me-2"></i>System Health</h5>
                </div>
                <div class="card-body">
                    <canvas id="securityChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Compliance & Audit -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-clipboard-check me-2"></i>Compliance & Audit Trail</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>SOX Compliance</h6>
                                <h4 class="text-success">100%</h4>
                                <small class="text-muted">Fully Compliant</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>PCI DSS</h6>
                                <h4 class="text-success">Level 1</h4>
                                <small class="text-muted">Certified</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>GDPR</h6>
                                <h4 class="text-success">Compliant</h4>
                                <small class="text-muted">Data Protected</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Audit Score</h6>
                                <h4 class="text-primary">A+</h4>
                                <small class="text-muted">Excellent</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Security metrics chart
    const securityCtx = document.getElementById('securityChart').getContext('2d');
    new Chart(securityCtx, {
        type: 'doughnut',
        data: {
            labels: ['Secure', 'Warnings', 'Critical'],
            datasets: [{
                data: [87, 10, 3],
                backgroundColor: [
                    '#198754',
                    '#ffc107',
                    '#dc3545'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
});

function emergencyLockdown() {
    if (confirm('This will immediately lock down all user access. Continue?')) {
        alert('Emergency lockdown activated. All user sessions terminated.');
    }
}

function forcePasswordReset() {
    alert('Password reset notifications sent to all users.');
}

function generateSecurityReport() {
    alert('Generating comprehensive security report...');
}

function runSecurityScan() {
    alert('Initiating full security scan. This may take several minutes.');
}
</script>
{% endblock %}