{% extends "islamic_banking/layout.html" %}

{% block title %}Murabaha Financing{% endblock %}

{% block content %}
<div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-white">
            <i class="fas fa-handshake text-primary me-2"></i>
            Murabaha Financing
        </h1>
        <div class="text-white-50">
            <i class="fas fa-certificate me-1"></i>
            {{ murabaha_data.compliance_status }}
        </div>
    </div>

    <!-- Portfolio Overview -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Portfolio Summary
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <h2 class="text-primary">${{ "%.1f"|format(murabaha_data.total_portfolio) }}B</h2>
                        <p class="text-muted">Total Portfolio</p>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <small class="text-muted">Active Contracts</small>
                                <div class="fw-bold">{{ "{:,}".format(murabaha_data.active_contracts) }}</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <small class="text-muted">Profit Rate</small>
                                <div class="fw-bold text-primary">{{ "%.2f"|format(murabaha_data.average_profit_rate) }%}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card border-0">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Murabaha Structure
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-3">Sharia Principles</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Sale-based financing (not interest)
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Asset ownership by bank
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Cost-plus pricing transparency
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    No Riba (interest) involved
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted mb-3">Transaction Process</h6>
                            <div class="d-flex align-items-center mb-2">
                                <div class="rounded-circle bg-primary text-white text-center" style="width: 30px; height: 30px; line-height: 30px;">1</div>
                                <span class="ms-2">Customer requests asset</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <div class="rounded-circle bg-primary text-white text-center" style="width: 30px; height: 30px; line-height: 30px;">2</div>
                                <span class="ms-2">Bank purchases asset</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <div class="rounded-circle bg-primary text-white text-center" style="width: 30px; height: 30px; line-height: 30px;">3</div>
                                <span class="ms-2">Bank sells to customer</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-primary text-white text-center" style="width: 30px; height: 30px; line-height: 30px;">4</div>
                                <span class="ms-2">Installment payments</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sector Distribution -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card border-0">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-industry me-2"></i>
                        Sector Distribution
                    </h5>
                </div>
                <div class="card-body">
                    {% for sector in murabaha_data.sectors %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">{{ sector }}:</span>
                            <span class="fw-bold">25.0%</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-{% if loop.index0 == 0 %}primary{% elif loop.index0 == 1 %}success{% elif loop.index0 == 2 %}warning{% else %}info{% endif %}" style="width: 25%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-0">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-calculator me-2"></i>
                        Murabaha Calculator
                    </h5>
                </div>
                <div class="card-body">
                    <form id="murabahaCalculator">
                        <div class="mb-3">
                            <label class="form-label text-white">Asset Cost ($)</label>
                            <input type="number" class="form-control" id="assetCost" placeholder="100,000" min="1000">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-white">Profit Margin (%)</label>
                            <input type="number" class="form-control" id="profitMargin" value="{{ '%.2f'|format(murabaha_data.average_profit_rate) }}" step="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-white">Term (Months)</label>
                            <select class="form-control" id="termMonths">
                                <option value="12">12 months</option>
                                <option value="24">24 months</option>
                                <option value="36">36 months</option>
                                <option value="48">48 months</option>
                                <option value="60">60 months</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-primary w-100" onclick="calculateMurabaha()">
                            <i class="fas fa-calculator me-2"></i>
                            Calculate Payment
                        </button>
                        <div id="calculationResult" class="mt-3 p-3 bg-light rounded" style="display: none;">
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">Total Cost:</small>
                                    <div class="fw-bold" id="totalCost">$0</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Monthly Payment:</small>
                                    <div class="fw-bold text-primary" id="monthlyPayment">$0</div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Applications -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Recent Murabaha Applications
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Application ID</th>
                                    <th>Customer</th>
                                    <th>Asset Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>MUR-2025-001</td>
                                    <td>Ahmed Al-Rashid</td>
                                    <td>Real Estate</td>
                                    <td class="fw-bold">$250,000</td>
                                    <td><span class="badge bg-success">Approved</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>MUR-2025-002</td>
                                    <td>Fatima Hassan</td>
                                    <td>Automotive</td>
                                    <td class="fw-bold">$45,000</td>
                                    <td><span class="badge bg-warning">Under Review</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>MUR-2025-003</td>
                                    <td>Omar Khalil</td>
                                    <td>Equipment</td>
                                    <td class="fw-bold">$125,000</td>
                                    <td><span class="badge bg-info">Processing</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-primary me-2">
                            <i class="fas fa-plus me-2"></i>
                            New Application
                        </button>
                        <a href="{{ url_for('islamic_banking.dashboard') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function calculateMurabaha() {
    const assetCost = parseFloat(document.getElementById('assetCost').value) || 0;
    const profitMargin = parseFloat(document.getElementById('profitMargin').value) || 0;
    const termMonths = parseInt(document.getElementById('termMonths').value) || 12;
    
    if (assetCost > 0) {
        const totalCost = assetCost * (1 + profitMargin / 100);
        const monthlyPayment = totalCost / termMonths;
        
        document.getElementById('totalCost').textContent = '$' + totalCost.toLocaleString();
        document.getElementById('monthlyPayment').textContent = '$' + monthlyPayment.toLocaleString();
        document.getElementById('calculationResult').style.display = 'block';
    }
}
</script>
{% endblock %}